{"version":3,"file":"commonHelpers.js","sources":["../src/pixabay.js","../src/index.js"],"sourcesContent":["import axios from 'axios';\nexport { fetchPixabayPhoto };\n\naxios.defaults.baseURL = \"https://pixabay.com/api/\";\nconst KEY = \"40365251-7556fc461aeff4605ce69e2bc\";\n\nasync function fetchPixabayPhoto(q, page, perPage) {\n\n    const url = `?key=${KEY}&q=${q}&page=${page}&per_page=${perPage}&image_type=photo&orientation=horizontal&safesearch=true`;\n    const { data } = await axios.get(url);\n\n    return data;\n};","import SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport { fetchPixabayPhoto } from \"./pixabay\";\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\n\n\nconst elems = {\n    form: document.querySelector('.search-form'),\n    gallery: document.querySelector('.gallery'),\n    btnLoadMore: document.querySelector('.load-more'),\n};\n\nconst body = document.querySelector('body');\nlet imageUrl = [];\nfunction bodyBG(imageUrl) {\n\n    if (imageUrl) {\n        let n = imageUrl.length;\n        let idx = Math.floor(Math.random() * n);\n        body.style.backgroundColor = 'transparent';\n        body.style.backgroundImage = `url(${imageUrl[idx]})`;\n        body.style.backgroundRepeat = 'no-repeat';\n        body.style.backgroundAttachment = 'fixed';\n    };\n};\n\n\n\nconst { form, gallery, btnLoadMore } = elems;\n\n\nconst perPage = 40;\nlet page = 1;\nlet keyOfSearchPhoto = '';\nlet isLoading = false;\n\n\n\nbtnLoadMore.style.display = 'none';\n\nform.addEventListener('submit', onSubmitForm);\n\nasync function onSubmitForm(event) {\n    event.preventDefault();\n    const { searchQuery } = event.currentTarget.elements;\n    imageUrl = [];\n    keyOfSearchPhoto = searchQuery.value\n        .trim()\n        .toLowerCase()\n        .split(' ')\n        .join('+');\n\n    if (keyOfSearchPhoto === '') {\n        // btnLoadMore.classList.add('is-hidden');\n        body.style.backgroundColor = '#fff';\n        body.style.backgroundImage = 'none';\n        iziToast.info({\n            message: 'Enter your request, please!',\n            position: 'center',\n            timeout: 4000,\n        });\n        return;\n    }\n    page = 1;\n    gallery.innerHTML = '';\n    event.currentTarget.reset();\n\n    try {\n\n        const { hits, total } = await fetchPixabayPhoto(keyOfSearchPhoto, page, perPage);\n\n        if (total === 0) {\n            // btnLoadMore.classList.add('is-hidden');\n            body.style.backgroundColor = '#fff';\n            iziToast.error({\n                message: 'Sorry, there are no images matching your search query. Please try again.',\n                position: 'center',\n                timeout: 4000,\n            });\n            return;\n        };\n        // btnLoadMore.classList.add('is-hidden');\n        body.style.backgroundColor = '#fff';\n        if (total <= perPage) {\n            iziToast.success({\n                message: `Hooray! We found ${total} images. But it's only 1 page`,\n                position: 'center',\n                timeout: 4000,\n            });\n        } else {\n            iziToast.success({\n                message: `Hooray! We found ${total} images.`,\n                position: 'center',\n                timeout: 4000,\n            });\n            window.addEventListener('scroll', showLoadMorePage);\n        };\n        createMarkup(hits);\n        bodyBG(imageUrl);\n        lightbox.refresh();\n    } catch (error) {\n        onFetchError(error.message);\n    };\n};\n\nfunction createMarkup(searchResults) {\n    const arrPhotos = searchResults.map(({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => {\n        imageUrl.push(largeImageURL);\n        return `<div class=\"photo-card\">\n        <div class=\"img_wrap\">\n            <a class=\"gallery_link\" href=\"${largeImageURL}\">\n                <img class=\"img\" src=\"${webformatURL}\" alt=\"${tags}\" width=\"300\" loading=\"lazy\" />\n            </a>\n        </div>\n        <div class=\"info\">\n            <p class=\"info-item\">\n            <b>Likes: </b><span class=\"value-num\">${likes}</span>\n            </p>\n            <p class=\"info-item\">\n            <b>Views: </b><span class=\"value-num\">${views}</span>\n            </p>\n            <p class=\"info-item\">\n            <b>Comments: </b><span class=\"value-num\">${comments}</span>\n            </p>\n            <p class=\"info-item\">\n            <b>Downloads: </b><span class=\"value-num\">${downloads}</span>\n            </p>\n        </div>\n        </div>`\n    });\n    gallery.insertAdjacentHTML(\"beforeend\", arrPhotos.join(''));\n};\n\nasync function onClickLoadMore() {\n    if (checkIfEndOfPage() && !isLoading) {\n        page += 1;\n        lightbox.refresh();\n\n        try {\n\n            isLoading = true;\n            const { hits, totalHits } = await fetchPixabayPhoto(keyOfSearchPhoto, page, perPage);\n            const numberOfPage = Math.ceil(totalHits / perPage);\n            createMarkup(hits);\n\n            if (page === numberOfPage && !isLoading) {\n                // btnLoadMore.classList.add('is-hidden');\n                iziToast.info({\n                    message: \"We're sorry, but you've reached the end of search results.\",\n                    position: 'center',\n                    timeout: 4000,\n                });\n                // btnLoadMore.removeEventListener('click', onClickLoadMore);\n                window.removeEventListener('scroll', showLoadMorePage);\n            };\n        } catch (error) {\n            onFetchError(error.message);\n        } finally {\n            isLoading = false;\n        };\n\n    };\n};\n\nfunction onFetchError(error) {\n    // btnLoadMore.classList.add('is-hidden');\n    body.style.backgroundColor = '#fff';\n    iziToast.error({\n        message: `Oops! Something went wrong! ${error} Try reloading the page or make another choice!`,\n        position: 'center',\n        timeout: 4000,\n    });\n};\n\n// function scrollPage() {\n//     const { height: cardHeight } = gallery.firstElementChild.getBoundingClientRect();\n\n//     window.scrollBy({\n//         top: cardHeight * 2,\n//         behavior: \"smooth\",\n//     });\n// };\n\nfunction showLoadMorePage() {\n    onClickLoadMore();\n};\n\nfunction checkIfEndOfPage() {\n    return (\n        window.innerHeight + window.scrollY >= document.documentElement.scrollHeight\n    );\n}\n\nlet lightbox = new SimpleLightbox('.img_wrap a', {\n    captionsData: 'alt',\n    captionDelay: 250,\n});"],"names":["axios","KEY","fetchPixabayPhoto","q","page","perPage","url","data","elems","body","imageUrl","bodyBG","n","idx","form","gallery","btnLoadMore","keyOfSearchPhoto","isLoading","onSubmitForm","event","searchQuery","iziToast","hits","total","showLoadMorePage","createMarkup","lightbox","error","onFetchError","searchResults","arrPhotos","webformatURL","largeImageURL","tags","likes","views","comments","downloads","onClickLoadMore","checkIfEndOfPage","totalHits","numberOfPage","SimpleLightbox"],"mappings":"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"}